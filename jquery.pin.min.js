(function(a){a.fn.pin=function(c){var g=0,f=[],d=false,h=a(window);c=c||{};c.top_offset=c.top_offset||0;var e=function(){for(var l=0,j=f.length;l<j;l++){var n=f[l];if(c.minWidth&&h.width()<=c.minWidth){if(n.parent().is(".pin-wrapper")){n.unwrap()}n.css({width:"",left:"",top:"",position:""});if(c.activeClass){n.removeClass(c.activeClass)}d=true;continue}else{d=false}var p=c.containerSelector?n.closest(c.containerSelector):a(document.body);var o=n.offset();var m=p.offset();var k=n.offsetParent().offset();if(!n.parent().is(".pin-wrapper")){n.wrap("<div class='pin-wrapper'>")}n.data("pin",{from:(c.containerSelector?m.top:o.top)-c.top_offset,to:m.top+p.height()-n.outerHeight(),end:m.top+p.height(),parentTop:k.top});n.css({width:n.outerWidth()});n.parent().css("height",n.outerHeight())}};var b=function(){if(d){return}g=h.scrollTop();for(var k=0,j=f.length;k<j;k++){var m=a(f[k]),l=m.data("pin"),o=l.from,n=l.to;if(o+m.outerHeight()>l.end){m.css("position","");continue}if(o<g&&n>g){!(m.css("position")=="fixed")&&m.css({left:m.offset().left,top:c.top_offset}).css("position","fixed");if(c.activeClass){m.addClass(c.activeClass)}}else{if(g>=n){m.css({left:"auto",top:n-l.parentTop+c.top_offset}).css("position","absolute");if(c.activeClass){m.addClass(c.activeClass)}}else{m.css({position:"",top:"",left:""});if(c.activeClass){m.removeClass(c.activeClass)}}}}};var i=function(){e();b()};this.each(function(){var k=a(this),j=a(this).data("pin")||{};if(j&&j.update){return}f.push(k);a("img",this).one("load",e);j.update=i;a(this).data("pin",j)});h.scroll(b);h.resize(function(){e()});e();h.load(i);return this}})(jQuery);